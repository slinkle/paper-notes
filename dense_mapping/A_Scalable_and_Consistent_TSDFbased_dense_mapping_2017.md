# A Scalable and Consistent TSDF-based Dense Mapping Approach

得到一个连续的压缩的，地图大小不会随着轨迹边长而大幅增长的TSDF稠密地图。

* map consistency
* scalability to limit map growth

通过概率计算得到享有冗余视角的subvolumes，然后进行融合。

<div align="center">
<img src="https://i.loli.net/2018/06/07/5b18d174da1f1.png"  />
</div>

## 体素整合：连续性

我们假设每个子体素内部是连续的，所以为保持地图的连续性我们需要今早且经常划分子体素。产生新的子体素的条件有两个：

1. 该子体素的关键帧的数目累积到一个极大值
2. 从稀疏地图中可以看出显著的跳跃变化

我们为提升voxblox的地图构建的时间性能，将其改造为多线程的快速构建方法：
（以下看不懂）：

大体思路是如果这个地区已经被其他射线扫描且构建过就直接放弃这条射线的信息。主要包括两种情况：

1. 计算starting points的密度：每一点开始都被插入一个叫做starting points的集合中，这个集合有着标准体素地图的两倍分辨率。如果已经有一个点占据了这个starting location，那这个点就会被抛弃。
2. 第二个中止条件是：检查这个体素是否已经被相同帧里面的其他射线见过了，维护一个“已观测体素”的集合。

## 地图融合

既要保证地图的连续性又要限制地图的无限制增长。我们限制地图无限制增长的方法是找出那些冗余的视角并进行融合，这样也能产生连续一致的结果。

我们通过一个共视图来判断哪些体素包含了冗余视角。每个体素有对应的产生这个体素的关键帧，可以对应到相应的路标点。covisibility graph的节点是体素点，边是体素之间对应的权重，表示两个体素之间的共视关系，其值是两个体素看到的共同路标点的个数。拥有较大的共视权重的一对体素点就会作为候选体素对儿被传到下一阶段。

<div align="center">
<img src="https://i.loli.net/2018/06/07/5b1915f5ac060.png"  />
</div>

此阶段判断体素对儿的relative localization的准确度，提出一个衡量该准确度的评价标准，为

<div align="center">
<img src="https://i.loli.net/2018/06/07/5b1915fa027d7.png"  />
</div>

达到某一最小阈值的q对应的体素对儿就会被融合？？？？（猜测：由于相对位姿估计的准确度不高，所以干脆融合在一起，如果相对位姿估计的很准直接都放在地图里）

## 体素融合

前面的很多步骤里都需要体素的融合，比如地图的融合，当前地图的可视化等。方法是三线性插值，用于立方体插值的。




